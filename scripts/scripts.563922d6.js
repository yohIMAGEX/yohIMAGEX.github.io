"use strict";function appConfig(a,b){var c={templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",resolve:{yearsData:["fraserData","$q",function(a,b){var c=b.defer();return a.getData().then(function(a){c.resolve(a)},function(){c.reject("data not found")}),c.promise}]}};a.when("/",c).when("/:catchAll*",c),b.html5Mode({enabled:!0,requireBase:!1})}function mainController(a,b){var c=this;c.yearsData=a,"dataset"==b.search().page||"graph"==b.search().page?c.page=b.search().page:c.page="map"}function mapDirectiveController(a,b,c){function d(){B=d3.geomap.choropleth().geofile("vendors/d3-geomap/topojson/world/countries.json").height(u).width($("#graph").width()).projection(d3.geo.mercator).colors(_.map(r.colorRange,"color")).column("summary_index").duration(!1).zoomFactor(2).domain([0,10]).unitId("iso_code").format(d3.format(",.02f")).legend(!1).onGeofileLoad(function(a){g(),f(),p()}).onClick(function(a){a&&(n(),o(),A.value(B._.zoomBehavior.scale()),$("#typeahead").select2("close"))}).postUpdate(e),C=d3.keys(r.yearsData);var a=C[C.length-1];r.slider.value=C.length,r.slider.dataValues=C,d3.select("#graph").datum(r.yearsData[a]).call(B.draw,B),w=r.yearsData[a]}function e(){k(),o(),m(),a.$apply()}function f(){d3.selectAll(".unit").on("mouseover",function(b){t=d3.select(".tooltip-map"),x=b.data;var c=x?parseFloat(x[B.column()],10):!1;console.log(c),r.tooltipCountry={name:b.properties.name,rank:x?b.data.ranking:"N/A",color:"#505050",flagClass:"flag-"+b.id.toLowerCase(),score:x&&c>0?c.toFixed(2):"N/A"},t.classed("hidden",!1),a.$apply()}).on("mousemove",function(){var b=d3.event,c=b.pageX-140,d=b.pageY-(t.node().getBoundingClientRect().height+15);t.classed("hidden",!1).attr("style","left:"+c+"px; top:"+d+"px"),a.$apply()}).on("mouseout",function(){t.classed("hidden",!0),x=null,r.tooltipCountry=null})}function g(){var a=$("#typeahead");c.getItems().then(function(b){function c(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}var d=(_.forEach(b,function(b){a.append($("<option>",b))}),{});$.fn.select2.amd.require(["select2/compat/matcher"],function(b){D=a.select2({dropdownParent:$(".header-controls"),dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a,b){if(a.loading)return a.text;var b=d.term||"",e=c(a.text,b);return e},matcher:b(function(a,b){return 0==b.toUpperCase().indexOf(a.toUpperCase())?!0:!1}),language:{searching:function(a){return d=a,"Searchingâ€¦"}},maximumSelectionLength:5})}),a.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&h(a.params.data.id)}),a.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&h(a.params.data.id)}),a.on("change",function(b,c){a.val()||[]})})}function h(a){var b=_.find(d3.selectAll(".unit").data(),{id:a});b&&B.clicked(b)}function i(){var a=parseInt(this.getAttribute("data-zoom")),b=1;d3.event.preventDefault(),b=B._.zoomBehavior.scale()+1*a,j(b)}function j(a){var b=[B.properties.width/2,B.properties.height/2],c=B._.zoomBehavior.scaleExtent(),d=B._.zoomBehavior.translate(),e=[],f=[],g={x:d[0],y:d[1],k:B._.zoomBehavior.scale()};return a<c[0]||a>c[1]?!1:(e=[(b[0]-g.x)/g.k,(b[1]-g.y)/g.k],g.k=a,f=[e[0]*g.k+g.x,e[1]*g.k+g.y],g.x+=b[0]-f[0],g.y+=b[1]-f[1],B._.zoomBehavior.scale(g.k),A.value(g.k),B._.zoomBehavior.translate([g.x,g.y]),B.zoom(),void 0)}function k(){r.tableData={mostFree:[],quartile2:[],quartile3:[],leastFree:[]};var a=d3.selectAll(".unit").data(),b=s-1,c=[],d=null,e=null,f=null,g=null,h=0,i="";b>=0&&(c=r.yearsData[C[b]]),a=a.filter(function(a){return a.data?!0:!1}),a.sort(function(a,b){return a.data.ranking-b.data.ranking});for(var j=0;j<a.length;j++)if(d=a[j].data,f=_.find(c,{iso_code:d.iso_code}),f&&(h=d[B.column()]-f[B.column()],0>h?i="fa-arrow-down":h>0&&(i="fa-arrow-up"),d.arrowClass=i),e=B.colorScale(d[B.column()]),g=_.find(r.colorRange,{color:e}))switch(g.name){case"most-free":r.tableData.mostFree.push(d);break;case"2nd-quart":r.tableData.quartile2.push(d);break;case"3rd-quart":r.tableData.quartile3.push(d);break;case"least-free":r.tableData.leastFree.push(d)}}function l(){v=$(".main-panel").width(),u=$(".main-panel").height(),B.path.projection().translate([v/2,u/2+150]).scale([v/5]).precision(.1),B.svg.attr("width",v).attr("height",u),B.svg.select("rect").attr("width",v).attr("height",u),B.svg.selectAll("path").attr("d",B.path),B.width(v),B.height(u)}function m(){y=window.setTimeout(function(){l(),window.clearTimeout(y)},200)}function n(a){$("#typeahead").val(_.map(B._.selectedList,function(a){return a.id.toUpperCase()})).trigger("change")}function o(){var b="world";E=[],d3.selectAll(".unit.active").each(function(a){E.push(a)}),r.selectedCountries=E,r.selectedCountries.length>0&&(b="country-info"),$('.nav-pills a[href="#'+b+'"]').tab("show"),a.$apply()}function p(){d3.select(".legend-panel").selectAll("div").data(_.reverse(r.colorRange)).enter().append("div").classed("legend-color",!0).style("background-color",function(a){return a.color})}function q(){B.data=r.yearsData[r.currentYear]||[],B.update()}var r=this;r.tableData={mostFree:[],quartile2:[],quartile3:[],leastFree:[]};var s=null;r.onSliderChange=function(b,c){s=b,r.currentYear=c,k(),q(),a.$apply()},r.slider={value:0,step:1,dataValues:[]},$(".disabled").click(function(a){return a.preventDefault(),!1});var t=null,u=$(".main-panel").height(),v=$(".main-panel").width(),w=($("#typeahead"),[],null),x=null,y=null,z=[{color:"#ee3b58",name:"least-free",value:3,text:"Least Free"},{color:"#fcab4a",name:"3rd-quart",value:2,text:"3rd Quartile"},{color:"#b8d051",name:"2nd-quart",value:1,text:"2nd Quartile"},{color:"#00bbbc",name:"most-free",value:0,text:"Most Free"}];r.colorRange=z;var A=d3.slider().min(1).max(10).step(1).orientation("vertical");d3.select("#zoom-slide").call(A),A.on("slide",function(){j(A.value())}),d3.selectAll("i[data-zoom]").on("click",i);var B,C,D,E;d(),d3.select(window).on("resize",m)}function sliderDirectiveLink(a,b,c){function d(){a.min=1,a.max=a.data.length,a.d3Slider=d3.slider().step("undefined"!=typeof a.step?a.step:1).value(a.value).animate(!1).min(a.min).max(a.max).orientation(a.orientation).snap(!1);var b=setInterval(function(){d3.select("."+a.id).selectAll("*").remove(),d3.select("."+a.id).call(a.d3Slider),$("."+a.id+" a.d3-slider-handle").append(l),_.isArray(a.value)?e(a.value):l.html(a.data[a.value-1]),a.safeApply(),window.clearInterval(b),f()},50);a.d3Slider.on("slide",function(){f()}),a.d3Slider.on("slideend",function(){f()})}function e(b){$("#handle-one .popover-single-value").html(a.data[b[0]-1]),$("#handle-two .popover-single-value").html(a.data[b[1]-1]);var c=$("#handle-two .popover-single-value").offset().left-$("#handle-one .popover-single-value").offset().left;$(".d3-slider-range").width(c)}function f(){var b=a.d3Slider.value();if(_.isArray(b))b[0]===b[1]&&b[0]--,e(b),a.onValueChange({dataValue:[b[0]-1,b[1]-1],value:[a.data[b[0]-1],a.data[b[1]-1]]});else{var c=a.d3Slider.value()-1,d=a.data[c];l.html(d),a.onValueChange({dataValue:c,value:d})}a.safeApply()}function g(){a.pauseState?h():i()}function h(){a.pauseState=!1,k=setInterval(function(){var b=a.d3Slider.value();if(b<a.max){j=!1;var c=b+a.step;a.d3Slider.value(c>a.max?a.max:c),f()}else j?(b=a.min,a.d3Slider.value(a.min)):(j=!0,i()),f(),a.safeApply()},750)}function i(){a.pauseState=!0,window.clearInterval(k),a.safeApply()}a.id="slider-"+(new Date).getTime(),a.pauseState=!0;var j=!0,k=null,l=$('<div class="slider-popover popover-single-value"></div>');a.$watch(function(){return a.data},function(a,b){d()}),a.$watch(function(){return a.value},function(a,b){d()}),a.playPause=g,d(),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}function fraserDataset(a,b){function c(){e.tableData=_.map(e.yearsData[e.currentYear],function(a){return a.year=e.currentYear,a.category=i(a.summary_index),a.trStyle={color:h(a.summary_index)},a.Area1[0].style={color:h(parseFloat(a.Area1[0].value))},a.Area2[0].style={color:h(parseFloat(a.Area2[0].value))},a.Area3[0].style={color:h(parseFloat(a.Area3[0].value))},a.Area4[0].style={color:h(parseFloat(a.Area4[0].value))},a.Area5[0].style={color:h(parseFloat(a.Area5[0].value))},a}),e.tableData.sort(function(a,b){return b.summary_index-a.summary_index}),e.tableData.forEach(function(a,b){a.ranking=b+1}),e.filterChanged()}function d(){var c=$(".chosen-select");c.html(""),a.getItems().then(function(a){function d(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}var f=(_.forEach(a,function(a){c.append($("<option>",a))}),{});g=c.select2({width:"100%",dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a){if(a.loading)return a.text;var b=f.term||"",c=d(a.text,b);return c},maximumSelectionLength:5}),c.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(e.filter.countries=c.val()||[],b.$apply())}),c.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(e.filter.countries=c.val()||[],b.$apply())}),c.on("change",function(a,d){e.filter.countries=c.val()||[],b.$apply()})})}var e=this,f=d3.keys(e.yearsData);e.slider={value:f.length,step:1,dataValues:f},e.onSliderChange=function(a,d){e.currentYear=d,c(),b.$apply()},e.filter={selected:null,limit:0,categories:[{id:1,name:"MOST FREE",cssClass:"filter-most-free",active:!0,color:"#00bbbc"},{id:2,name:"2ND QUARTILE",cssClass:"filter-2nd-quart",active:!0,color:"#b8d051"},{id:3,name:"3RD QUARTILE",cssClass:"filter-3rd-quart",active:!0,color:"#fcab4a"},{id:4,name:"LEAST FREE",cssClass:"filter-least-free",active:!0,color:"#ee3b58"}],countries:[]},e.tableCategoryFilter=function(a){if(2!=e.filter.selected)return a;var b=_.find(e.filter.categories,{id:a.category});return b.active?a:void 0},e.tableCountryFilter=function(a,b,c){return 1!=e.filter.selected?a:0==e.filter.countries.length?a:e.filter.countries.indexOf(a.iso_code)>=0?a:void 0},e.filterChanged=function(){3==e.filter.selected?e.filter.limit=10:e.filter.limit=e.tableData.length},e.filterList=[{id:0,name:"ALL"},{id:1,name:"INDIVIDUAL COUNTRY"},{id:2,name:"ECONOMIC FREEDOM QUARTILE"},{id:3,name:"TOP 10 COUNTRIES"}],e.selectFilter=function(a){e.filter.selectedText=a.name,e.filter.selected=a.id,e.filterChanged()},e.filter.selectedText=e.filterList[0].name,e.filter.selected=e.filterList[0].id,e.tableData=[];var g,h=d3.scale.quantize().domain([0,10]).range(_.map(e.filter.categories,"color").reverse()),i=d3.scale.quantize().domain([0,10]).range(_.map(e.filter.categories,"id").reverse());c(),d()}function fraserGraph(a,b){function c(){_.forEach(o.yearsData,function(a,b){o.worldData[b]=d(a,b)})}function d(a,b){var c=_.extend(g(),{year:b,country:"World",iso_code:"WOR"}),d="",e=0,f=0;a.forEach(function(a){a.year=b;for(var f=0;f<o.categories.length;f++)d=o.categories[f].key,e=_.get(c,d,0)+_.get(a,d,0),_.set(c,d,e)}),e=0;for(var h=0;h<o.categories.length;h++)d=o.categories[h].key,e=_.get(c,d,0)/a.length,_.set(c,d,e),f+=e;return c.summary_index=f/o.categories.length,c}function e(){q=$("#charts").width();var a={top:20,right:20,bottom:30,left:20};q=q-a.left-a.right,r=400-a.top-a.bottom,y=d3.scale.ordinal().rangeRoundBands([0,q],.1),x=d3.scale.ordinal().rangeRoundBands([0,q],.1),z=d3.scale.ordinal(),A=d3.scale.linear().range([r,0]).domain([0,10]),s=d3.svg.axis().scale(x).orient("bottom"),t=d3.svg.axis().scale(y).orient("bottom"),u=d3.svg.axis().innerTickSize(-q).outerTickSize(0).scale(A).orient("left"),v=d3.select("#charts").append("svg").attr("width",q+a.left+a.right).attr("height",r+a.top+a.bottom).attr("align","center").append("g").attr("transform","translate("+a.left+","+a.top+")"),v.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",5).attr("dy","1em").style("text-anchor","end");var b=d3.select(v.selectAll(".y.axis .tick")[0][0]);b.select("text").attr("visibility","hidden"),b.select("line").attr("class","first-y-axis"),w=v.append("g").attr("class","tooltip-chart").style("display","none"),w.append("rect").attr("width",40).attr("height",20).attr("fill","white").style("opacity",1),w.append("text").attr("x",15).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold")}function f(){var a=o.yearsData[o.currentYear];if(o.filter.countries.length>0){var c=_.filter(o.countriesList,function(a){return o.filter.countries.indexOf(a.value)>=0}),d={};o.graphData=_.map(c,function(b){return d=_.find(a,{iso_code:b.value}),b.country=b.text,b.summary_index=0,d&&(b.Area1=d.Area1,b.Area2=d.Area2,b.Area3=d.Area3,b.Area4=d.Area4,b.Area5=d.Area5,b.summary_index=d.summary_index),b})}else o.graphData=[o.worldData[o.currentYear]];b.safeApply(),m()}function g(){return{Area1:[{value:0}],Area2:[{value:0}],Area3:[{value:0}],Area4:[{value:0}],Area5:[{value:0}],summary_index:0}}function h(a){var b=_.filter(o.categories,{active:!0});return b.length!==o.categories.length&&b.length>0&&(a.calculated_index=0,_.forEach(b,function(c){var d=+_.get(a,c.key,0).toFixed(2)/b.length;a.calculated_index+=d})),a}function i(){o.lineGraphData=[];var a,b,c,d=o.dateRange,e=[];if(o.filter.countries.length>0){var f=_.filter(o.countriesList,function(a){return o.filter.countries.indexOf(a.value)>=0});o.lineGraphData=f.map(function(f,i){a={iso_code:f.value,country:f.text,color:o.categories[i].color,values:[]};for(var j=d[0];j<=d[1];j++)c=o.dataPoints[j],e=o.yearsData[c],b=_.find(e,{iso_code:f.value}),b=b?b:g(),b.year=c,b.calculated_index=b.summary_index,b=h(b),a.values.push(b);return a})}else{for(var i=[],j=d[0];j<=d[1];j++)c=o.dataPoints[j],b=o.worldData[c],b.calculated_index=b.summary_index,i.push(h(b));o.lineGraphData=[{iso_code:"WOR",country:"WORLD",color:o.categories[0].color,values:i}]}o.lineGraphData=_.map(o.lineGraphData,function(a){return a}),l()}function j(){v.select(".x.axis").remove(),v.selectAll(".country").remove(),v.selectAll(".line-graph").remove()}function k(){"bar"===o.graphSelector?f():i(),b.safeApply()}function l(){j(),y.domain(_.filter(o.dataPoints,function(a,b){return b>=o.dateRange[0]&&b<=o.dateRange[1]?a:void 0})),v.append("g").attr("class","x axis line-x-axis").attr("transform","translate(0,"+r+")").call(t);var a=d3.svg.line().x(function(a){return y(a.year)+y.rangeBand()/2-20}).y(function(a){return A(a.calculated_index)}).defined(function(a){return a.calculated_index>0}),b=v.append("g").attr("transform","translate(20,20)").attr("class","line-graph"),c=b.selectAll(".country").data(o.lineGraphData).enter().append("g").attr("class","country");c.append("path").attr("class","line").attr("style",function(a,b){return"stroke : "+a.color+";"}).attr("d",function(b){return a(b.values)});var d;o.lineGraphData.forEach(function(a){d=_.filter(a.values,function(a){return a.calculated_index>0}),c.selectAll(".circle-"+a.iso_code).data(d).enter().append("circle").attr("class","circle-"+a.iso_code).attr("style",function(b,c){return"stroke : "+a.color+";"}).attr("r",4).attr("cx",function(a){return y(a.year)+y.rangeBand()/2-20}).attr("cy",function(a){return A(a.calculated_index)})})}function m(){j();var a=_.filter(o.categories,{active:!0});o.graphData.forEach(function(b){b.categories=_.map(a,function(a){var c=+_.get(b,a.key,0).toFixed(2);return{name:a.name,value:c,label:c>.5?c:"N/A",color:a.color}})}),x.domain(o.graphData.map(function(a){return a.country}));var c=d3.min([(q-100)/5,150]);z.domain(o.categories.filter(function(a){return a.active}).map(function(a){return a.name})).rangeRoundBands([0,c]),v.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(s);var d=v.selectAll(".country").data(o.graphData),e=d.enter().append("g").attr("class","country").style("fill","blue").attr("transform",function(a){return"translate("+x(a.country)+",0)"}),f=e.selectAll("rect").data(function(a){return a.categories});f.enter().append("rect").attr("width",z.rangeBand()-2).attr("x",function(a){return z(a.name)+1+x.rangeBand()/2-c/2}).attr("y",function(a){return A(a.value)}).attr("height",function(a){return r-A(a.value)}).style("fill",function(a){return a.color}).on("mouseover",function(){w.style("display",null)}).on("mouseout",function(){w.style("display","none")}).on("mousemove",function(a,b){w.attr("transform","translate("+(z(a.name)+z.rangeBand())+","+(A(a.value)-40)+")"),w.select("text").text(a.label)}),f.exit().remove(),b.safeApply()}function n(){var b=$("#typeahead");a.getItems().then(function(a){function c(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}e(),o.countriesList=a;var d=(_.forEach(a,function(a){b.append($("<option>",a))}),{});B=b.select2({dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a){if(a.loading)return a.text;var b=d.term||"",e=c(a.text,b);return e},maximumSelectionLength:5}),b.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(o.filter.countries=b.val()||[],k())}),b.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(o.filter.countries=b.val()||[],k())}),b.on("change",function(a,c){o.filter.countries=b.val()||[],k()})})}var o=this;o.worldData={},b.safeApply=function(a){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?a&&"function"==typeof a&&a():b.$apply(a)},o.graphSelector="line",o.selectAllCategories=!0;var p=d3.keys(o.yearsData);o.dataPoints=p,o.slider={value:[o.dataPoints.length-5,o.dataPoints.length],step:1,dataValues:p},o.onSliderChange=function(a,b){_.isArray(a)?o.dateRange=a:o.currentYear=b,k()},o.toggleCategory=function(a){a.active=!a.active,k()},o.toggleAllCategories=function(a){a||(o.selectAllCategories=!o.selectAllCategories),o.categories.forEach(function(a){a.active=o.selectAllCategories}),k()},o.changeGraph=function(a){o.graphSelector=a,"line"===o.graphSelector?o.slider.value=[o.dataPoints.length-5,o.dataPoints.length]:o.slider.value=21,k()},o.filter={countries:[]},o.categories=[{name:"Size of Government",active:!0,color:"#ce0932",key:"Area1[0].value"},{name:"Legal System and Property Rights",active:!0,color:"#dd8c2c",key:"Area2[0].value"},{name:"Sound Money",active:!0,color:"#74862c",key:"Area3[0].value"},{name:"Freedom to Trade Internationally",active:!0,color:"#00a3a4",key:"Area4[0].value"},{name:"Regulation",active:!0,color:"#90a738",key:"Area5[0].value"}],o.buildGraphData=k;var q,r,s,t,u,v,w,x,y,z,A,B;c(),n()}function dataService(a,b){var c=36e5;return"localStorage"in window||(window.localStorage={_data:{},setItem:function(a,b){return this._data[a]=String(b)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:void 0},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}}),{getData:function(){var d=b.defer(),e=window.localStorage.getItem("fraser.data"),f=window.localStorage.getItem("fraser.data.time");f=f?+f:0;var g=(new Date).getTime()-f>c;return e&&!g?d.resolve(JSON.parse(e)):a.get("/fraser.json",{cache:!0}).then(function(a){200==a.status&&200==a.data.code&&a.data.data&&(window.localStorage.setItem("fraser.data",JSON.stringify(a.data.data)),window.localStorage.setItem("fraser.data.time",(new Date).getTime()),d.resolve(a.data.data))},function(a){d.reject(a)}),d.promise}}}function typeAheadService(a,b){var c=[],e=[];return{setItems:function(a){c=a},getItems:function(){var e=b.defer();return c.length>0?d.resolve(c):a.get("vendors/d3-geomap/topojson/world/countries.json").then(function(a){200==a.status?(c=_.map(_.get(a,"data.objects.units.geometries"),function(a){return{value:a.id,text:a.properties.name}}),e.resolve(c)):e.reject("data not found")},function(){e.reject("data not found")}),e.promise},setSelected:function(a){e=a},getSelecetd:function(){return e}}}angular.module("fraserMapApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(appConfig),appConfig.$inject=["$routeProvider","$locationProvider"],angular.module("fraserMapApp").controller("MainCtrl",mainController),mainController.$inject=["yearsData","$location"],angular.module("fraserMapApp").directive("fraserMap",function(){return{templateUrl:"views/map-page.html",restrict:"E",controller:mapDirectiveController,controllerAs:"vm",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),mapDirectiveController.$inject=["$scope","$timeout","typeaheadService"],angular.module("fraserMapApp").directive("fraserSlider",function(){return{templateUrl:"views/partials/slider.html",restrict:"E",scope:{orientation:"=",step:"=",value:"=",data:"=",showPlay:"=",onValueChange:"&"},link:sliderDirectiveLink}}),angular.module("fraserMapApp").directive("mapCountryPanel",function(){return{templateUrl:"views/partials/map-country-panel.html",restrict:"E",scope:{country:"=",colorRange:"="},link:function(a,b,c){a.data={},a.data.summary_index=a.country.data?a.country.data.summary_index+" / 10":"N/A",a.data.name=a.country.properties.name,a.data.flagIcon="flag-"+a.country.id.toLowerCase(),a.data.color=_.get(a.country,"data.color",null);var d=_.find(a.colorRange,{color:a.data.color});a.data.labelClass="label label-nodata",a.data.labelText="no data",d&&(a.data.labelClass="label label-"+d.name,a.data.labelText=d.text),a.articles=[{head:"Size of Government",icon:"fa-area-chart",key:"data.Area1[0].value",value:null},{head:"Legal System and Property Rights",icon:"fa-first-order",key:"data.Area2[0].value",value:null},{head:"Sound Money",icon:"fa-archive",key:"data.Area3[0].value",value:null},{head:"Freedom to Trade Internationally",icon:"fa-building",key:"data.Area4[0].value",value:null},{head:"Regulation",icon:"fa-beer",key:"data.Area5[0].value",value:null}];var e;a.articles.forEach(function(b){e=_.get(a.country,b.key,null),b.value=e?parseFloat(e).toFixed(2):"N/A"})}}}),angular.module("fraserMapApp").directive("fraserDataset",function(){return{templateUrl:"views/dataset-page.html",controllerAs:"vm",controller:fraserDataset,restrict:"E",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),fraserDataset.$inject=["typeaheadService","$scope"],angular.module("fraserMapApp").directive("fraserGraph",function(){return{templateUrl:"views/graph-page.html",controllerAs:"vm",controller:fraserGraph,restrict:"E",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),fraserGraph.$inject=["typeaheadService","$scope"],angular.module("fraserMapApp").service("fraserData",dataService),dataService.$inject=["$http","$q"],angular.module("fraserMapApp").service("typeaheadService",typeAheadService),typeAheadService.$inject=["$http","$q"],angular.module("fraserMapApp").run(["$templateCache",function(a){a.put("views/dataset-page.html",'<div class="container-fluid dataset-header"> <div class="col-sm-offset-1 col-md-10 dataset-header-container"> <div class="col-md-9 dataset-header-wrapper"> <div class="dataset-title">Download Dataset</div> <div class="dataset-subtitle">Economic Freedom Rankings</div> <div class="dropdown dataset-datarange-selector"> <span class="dropdown-toggle" type="button" data-toggle="dropdown"> Select Data Range <span class="caret"></span> </span> <ul class="dropdown-menu"> <li><a>Date Range</a></li> <li><a>Specific Dates</a></li> </ul> </div> </div> <div class="col-md-3 fraser-download-container"> <div class="fraser-download-container--cell"> <div class="fraser-download-container--wrapper"> <button class="btn btn-primary fraser-download-button"> Download Entire Dataset <i class="fa fa-download fraser-download-button--icon" aria-hidden="true"></i> </button> </div> </div> </div> </div> <div class="col-sm-offset-1 col-md-10 dataset-slider-container"> <fraser-slider show-play="false" step="1" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"> </fraser-slider> </div> </div> <div class="container-fluid filters"> <div class="col-sm-offset-1 col-md-10 filters-wrapper"> <i class="fa fa-filter filter-icon" aria-hidden="true"></i> <span>Filter By : </span> <span class="dropdown dataset-filter-selector"> <span class="dropdown-toggle dataset-filter-button" type="button" data-toggle="dropdown"> {{vm.filter.selectedText}} <span class="caret"></span> </span> <ul class="dropdown-menu"> <li ng-repeat="filter in vm.filterList" ng-click="vm.selectFilter(filter)"> <a ng-bind="filter.name"></a> </li> </ul> </span> <span class="dataset-filter-container"> <div class="quartile-filters" ng-show="vm.filter.selected == 2"> <span ng-repeat="category in vm.filter.categories" ng-click="category.active = !category.active" class="{{category.cssClass}}" ng-class="{\'inactive\': !category.active}" ng-bind="category.name"></span> </div> <div class="typeahead-filters" ng-show="vm.filter.selected == 1"> <select data-placeholder="Find a country" multiple class="chosen-select"> <option></option> </select> </div> </span> <span class="filter-download-wrapper"> <button class="btn btn-primary fraser-download-filtered-button"> Download Filtered Dataset <i class="fa fa-download fraser-download-button--icon" aria-hidden="true"></i> </button> </span> </div> </div> <div class="dataset-panel container-fluid"> <div class="col-sm-offset-1 col-md-10 dataset-table-panel"> <table class="table dataset-table"> <thead> <tr> <th width="20">OVERALL RANK</th> <th>COUNTRY NAME</th> <th width="20">YEAR</th> <th class="text-right" width="40">OVERALL SCORE</th> <th class="text-right" width="13%">LEGAL STRUCTURE & SECURITY OF PROPERTIES RIGHTS</th> <th class="text-right" width="13%">SIZE OF GOVERMENT</th> <th class="text-right" width="13%">ACCESS TO SOUND MONEY</th> <th class="text-right" width="13%">FREEDOM TO TRADE ITER.</th> <th class="text-right" width="13%">REGAULATION OF CREDIT</th> </tr> </thead> <tbody> <tr ng-repeat="entry in vm.tableData  \n          | limitTo : vm.filter.limit \n          | filter : vm.tableCategoryFilter\n          | filter : vm.tableCountryFilter\n          track by $index"> <td ng-bind="entry.ranking" ng-style="entry.trStyle"></td> <td ng-bind="entry.country"></td> <td ng-bind="entry.year"></td> <td class="text-right" ng-bind="entry.summary_index | number: 2" ng-style="entry.trStyle"></td> <td class="text-right" ng-bind="entry.Area1[0].value | number: 2" ng-style="entry.Area1[0].style"></td> <td class="text-right" ng-bind="entry.Area2[0].value | number: 2" ng-style="entry.Area2[0].style"></td> <td class="text-right" ng-bind="entry.Area3[0].value | number: 2" ng-style="entry.Area3[0].style"></td> <td class="text-right" ng-bind="entry.Area4[0].value | number: 2" ng-style="entry.Area4[0].style"></td> <td class="text-right" ng-bind="entry.Area5[0].value | number: 2" ng-style="entry.Area5[0].style"></td> </tr> </tbody> </table> </div> </div>'),a.put("views/graph-page.html",'<div class="container-fluid charts-topbar"> <div class="col-sm-offset-2 col-md-10"> <select data-placeholder="Find a country" id="typeahead" multiple class="chosen-select"> <option></option> </select> </div> </div> <div class="charts-container container-fluid"> <div class="col-md-2 charts-selection-panel"> <div class="charts-selector"> <div class="charts-selector-text">GRAPH</div> <div ng-class="{\'active\' : vm.graphSelector == \'line\'}" ng-click="vm.changeGraph(\'line\');" class="charts-selector-buttom"> <i class="fa fa-line-chart" aria-hidden="true"></i> </div> <div ng-class="{\'active\' : vm.graphSelector == \'bar\'}" ng-click="vm.changeGraph(\'bar\')" class="charts-selector-buttom"> <i class="fa fa-bar-chart" aria-hidden="true"></i> </div> </div> </div> <div class="col-md-8"> <div id="charts"></div> <fraser-slider class="charts-timebar" show-play="false" step="1" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"> </fraser-slider> </div> <div class="col-md-2"> <div class="legend" ng-if="vm.graphSelector == \'bar\'"> <div ng-repeat="category in vm.categories" class="pointer legend-row" ng-click="vm.toggleCategory(category)"> <span> <i class="fa fa-circle" aria-hidden="true" ng-style="{\n              color: category.active ? category.color : \'gray\'\n            }"> </i> </span> <span ng-bind="category.name" class="category-text"></span> </div> <div class="pointer" ng-click="vm.toggleAllCategories()"> <span ng-bind="vm.selectAllCategories ? \'Deselect All\' : \'Select All\'" class="category-text"></span> </div> </div> <div class="legend" ng-if="vm.graphSelector == \'line\'"> <div ng-repeat="country in vm.lineGraphData" class="pointer legend-row"> <span> <i class="fa fa-circle" aria-hidden="true" ng-style="{\n              color: country.color\n            }"> </i> </span> <span ng-bind="country.country" class="category-text"></span> </div> <div class="graph-category-filter"> <div class="graph-category-filter--title">Filter By Category : </div> <div> <ul class="line-graph-filter-list"> <li class="line-graph-filter-list--item"> <input ng-click="vm.toggleAllCategories(true)" type="checkbox" ng-model="vm.selectAllCategories" ng-attr-id="{{\'category-check-\' + $index}}"> <label for="{{\'category-check-\' + $index}}"> All </label> </li> <li class="line-graph-filter-list--item" ng-repeat="category in vm.categories track by $index"> <input ng-change="vm.buildGraphData()" type="checkbox" ng-model="category.active" ng-attr-id="{{\'category-check-\' + $index}}"> <label for="{{\'category-check-\' + $index}}" ng-bind="category.name"></label> </li> </ul> </div> </div> </div> </div> </div>'),a.put("views/main.html",'<fraser-map ng-if="main.page == \'map\'" years-data="main.yearsData"> </fraser-map> <fraser-graph ng-if="main.page == \'graph\'" years-data="main.yearsData"> </fraser-graph> <fraser-dataset class="dataset-page" ng-if="main.page == \'dataset\'" years-data="main.yearsData"> </fraser-dataset>'),a.put("views/map-page.html",'<div class="container-map"> <div class="side-panel"> <ul class="nav nav-pills nav-justified"> <li class="map-tab active"><a data-toggle="tab" href="#world">WORLD RANKINGS</a></li> <li class="country-info--tab disabled"><a data-toggle="tab" href="#country-info">COUNTRY INFO</a></li> </ul> <div class="tab-content"> <!-- WORLD TAB --> <div id="world" class="tab-pane fade in active"> <div class="world-tab-header"> <div class="text-center world-tab-title"> Economic Freedom <br> Ranking <span class="freedom-ranking-year" ng-bind="vm.currentYear"></span> </div> <div class="share-block"> <div class="pull-left text">Share : </div> <div class="pull-right social-icons"> <i class="fa fa-envelope pointer mail" aria-hidden="true"></i> <i class="fa fa-facebook-official pointer facebook" aria-hidden="true"></i> <i class="fa fa-twitter-square pointer twitter" aria-hidden="true"></i> </div> <div class="clearfix"></div> </div> </div> <div class="country-list-wrapper"> <table class="table country-list"> <thead> <tr> <th>#</th> <th>Country</th> <th>Score</th> </tr> </thead> <tbody> <tr class="most-free-tr" ng-if="vm.tableData.mostFree.length > 0"> <th class="first-free-th" colspan="3"> <span class="label label-most-free">Most Free</span> </th> </tr> <tr ng-if="vm.tableData.mostFree.length > 0" ng-repeat="country in vm.tableData.mostFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="second-free-tr" ng-if="vm.tableData.quartile2.length > 0"> <th class="second-free-th" colspan="3"> <span class="label label-2nd-quart">2nd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile2.length > 0" ng-repeat="country in vm.tableData.quartile2 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="third-free-tr" ng-if="vm.tableData.quartile3.length > 0"> <th class="third-free-th" colspan="3"> <span class="label label-3rd-quart">3rd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile3.length > 0" ng-repeat="country in vm.tableData.quartile3 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"></tr> <tr class="least-free-tr" ng-if="vm.tableData.leastFree.length > 0"> <th class="least-free-th" colspan="3"> <span class="label label-least-free">Least Free</span> </th> </tr> <tr ng-if="vm.tableData.leastFree.length > 0" ng-repeat="country in vm.tableData.leastFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="end-tr"> </tr> </tbody> </table> </div> </div> <!-- END OF WORLD TAB --> <!-- COUNTRY INFO TAB --> <div id="country-info" class="tab-pane fade"> <div id="selected-countries"> <map-country-panel ng-repeat="country in vm.selectedCountries" color-range="vm.colorRange" country="country"></map-country-panel> </div> </div> <!-- END OF COUNTRY INFO TAB --> </div> </div> <div class="main-panel"> <div id="graph"> <div class="header-controls"> <select data-placeholder="Find a country" id="typeahead" multiple class="chosen-select"> <option></option> </select> </div> <div class="legend-panel"></div> </div> <div class="zoom-buttons"> <i class="fa fa-plus-square pointer" aria-hidden="true" id="zoom_in" data-zoom="+1"></i> <div id="zoom-slide"></div> <i class="fa fa-minus-square pointer" aria-hidden="true" id="zoom_out" data-zoom="-1"></i> </div> <fraser-slider show-play="true" class="footer-controls" step="vm.slider.step" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"></fraser-slider> </div> </div> <ng-include src="\'views/partials/map-tooltip.html\'"></ng-include> '),
a.put("views/partials/map-country-panel.html",'<div class="country-info--item"> <div class="text-center"> <div> <span class="country-flag flag flag-3x" ng-class="data.flagIcon"></span> </div> <h2 class="country-name" ng-bind="data.name"></h2> <h5 class="ranking"> <span class="value" ng-bind="data.summary_index"></span> </h5> <span class="label" ng-class="data.labelClass" ng-bind="data.labelText"></span> <ul class="row"> <li ng-class="{\'no-border\' : $last}" ng-repeat="article in articles track by $index"> <span><i class="article-icon fa" ng-class="article.icon" aria-hidden="true"></i></span> <span class="article-value" ng-bind="article.value"></span> <span class="article-title" ng-bind="article.head"></span> </li> </ul> </div> </div>'),a.put("views/partials/map-sidepanel-world-tab.html",'<div id="world" class="tab-pane fade in active"> <div class="text-center"> <h5>Economic Freedom Ranking</h5> <h2 class="freedom-ranking-year" ng-bind="vm.currentYear"></h2> </div> <div class="share-block"> <div class="pull-left">Share on : </div> <div class="pull-right social-icons"> <i class="fa fa-envelope pointer" aria-hidden="true"></i> <i class="fa fa-facebook-official pointer" aria-hidden="true"></i> <i class="fa fa-twitter-square pointer" aria-hidden="true"></i> </div> <div class="clearfix"></div> </div> <table class="table country-list"> <thead> <tr> <th>#</th> <th>Country</th> <th>Score</th> </tr> </thead> <tbody> <tr class="most-free-tr" ng-if="vm.tableData.mostFree.length > 0"> <th class="first-free-th" colspan="3"> <span class="label label-most-free">Most Free</span> </th> </tr> <tr ng-if="vm.tableData.mostFree.length > 0" ng-repeat="country in vm.tableData.mostFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="second-free-tr" ng-if="vm.tableData.quartile2.length > 0"> <th class="second-free-th" colspan="3"> <span class="label label-2nd-quart">2nd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile2.length > 0" ng-repeat="country in vm.tableData.quartile2 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="third-free-tr" ng-if="vm.tableData.quartile3.length > 0"> <th class="third-free-th" colspan="3"> <span class="label label-3rd-quart">3rd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile3.length > 0" ng-repeat="country in vm.tableData.quartile3 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"></tr> <tr class="least-free-tr" ng-if="vm.tableData.leastFree.length > 0"> <th class="least-free-th" colspan="3"> <span class="label label-least-free">Least Free</span> </th> </tr> <tr ng-if="vm.tableData.leastFree.length > 0" ng-repeat="country in vm.tableData.leastFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="end-tr"> </tr> </tbody> </table> </div>'),a.put("views/partials/map-table-row.html",'<td ng-bind="country.ranking" style="color: {{country.color}}"> </td> <td ng-bind="country.country"> </td> <td style="color: {{country.color}}"> <span ng-bind="country.summary_index | number : 2"></span> <i class="ranking-difference-indicator fa" ng-class="country.arrowClass" aria-hidden="true"></i> </td>'),a.put("views/partials/map-tooltip.html",'<div class="hiddens tooltip-map"> <div class=""> <span class="tooltip--country-flag flag flag-2x" ng-class="vm.tooltipCountry.flagClass"></span> <span class="country-title" ng-bind="vm.tooltipCountry.name"></span> </div> <div class="country-rank" ng-style="{color: vm.tooltipCountry.color}"> <div class="rank"> <div ng-bind="vm.tooltipCountry.rank"> </div> <div class="rank-title"> RANK</div> </div> <div class="overall"> <div ng-bind="vm.tooltipCountry.score"></div> <div class="score-title">SCORE</div> </div> <div class="clear-both"></div> </div> </div>'),a.put("views/partials/slider.html",'<div class="fraser-slider" ng-class="{\'no-play\' : !showPlay}"> <span ng-if="showPlay"> <span class="timeline-buttom play pointer" ng-click="playPause()"> <i class="fa" ng-class="{\'fa-play\': pauseState, \'fa-pause\': !pauseState}" aria-hidden="true"></i> </span> <span class="timeline-text" ng-bind="pauseState?\'play\':\'pause\';"> </span> </span> <span class="timeline-value min" ng-bind="data[min-1]"></span> <span class="{{id}}"></span> <span class="timeline-value max" ng-bind="data[max-1]"></span> </div>')}]);