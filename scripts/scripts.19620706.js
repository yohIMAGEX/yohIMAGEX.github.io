"use strict";function appConfig(a,b){var c={templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",reloadOnSearch:!1,resolve:{yearsData:["fraserData","$q","$rootScope",function(a,b,c){var d=b.defer();return c.showLoading=!0,a.getData().then(function(a){d.resolve(a),c.showLoading=!1},function(){d.reject("data not found"),c.showLoading=!1}),d.promise}]}};a.when("/",c).when("/:catchAll*",c),b.html5Mode({enabled:!0,requireBase:!1})}function appRun(a){a.showLoading=!0}function mainController(a,b,c,d){var e=this;e.yearsData=a,d.showLoading=!1,c.restoreQueryStrings(),"dataset"==b.search().page||"graph"==b.search().page?e.page=b.search().page:(e.page="map",b.search("page",e.page))}function mapDirectiveController(a,b,c,d){function e(){d.clearAreaParams(),d.updateQueryParam("min-year",null),d.updateQueryParam("sort-field",null),d.updateQueryParam("sort-reversed",null),d.updateQueryParam("date-type",null),d.updateQueryParam("filter",null),d.updateQueryParam("most-free",null),d.updateQueryParam("least-free",null),d.updateQueryParam("quartile3",null),d.updateQueryParam("quartile2",null);var a=d.getQueryParamValue("max-year",null),b=d.getQueryParamValue("year",null);D=d3.keys(t.yearsData),G=_.last(D),+a?D.indexOf(a)>0&&(G=a):+b&&D.indexOf(b)>0&&(G=b),t.currentYear=G,d.updateQueryParam("max-year",null),d.updateQueryParam("type",null),d.updateQueryParam("year",G),$(".disabled").click(function(a){return a.preventDefault(),!1}),f()}function f(){x=$("#graph").width(),C=d3.geomap.choropleth().geofile("vendors/d3-geomap/topojson/world/countries.json").height(w).width(x).projection(d3.geo.mercator).colors(_.map(t.colorRange,"color")).column("summary_index").duration(!1).zoomFactor(2).domain([0,10]).unitId("iso_code").format(d3.format(",.02f")).legend(!1).onGeofileLoad(function(a){o(),i(),h(),r()}).onClick(function(a){a&&(p(),q(),B.value(C._.zoomBehavior.scale()))}).postUpdate(g);var a=G;t.slider.value=D.indexOf(G)+1,t.slider.dataValues=D,d3.select("#graph").datum(t.yearsData[a]).call(C.draw,C),y=t.yearsData[a]}function g(){m(),q(),a.safeApply()}function h(){d3.selectAll(".unit").on("mouseover",function(b){v=d3.select(".tooltip-map"),z=b.data;var c=z?parseFloat(z[C.column()],10):!1;t.tooltipCountry={name:b.properties.name,rank:z?b.data.ranking:"N/A",color:"#505050",flagClass:"flag-"+b.id.toLowerCase(),score:z&&c>0?c.toFixed(2):"N/A"},v.classed("hidden",!1),a.safeApply()}).on("mousemove",function(){var b=d3.event,c=$(".container-map").offset(),d=b.clientX-150,e=b.clientY-(v.node().getBoundingClientRect().height+8);v.classed("hidden",!1).attr("style","left:"+(d-c.left)+"px; top:"+(e-c.top)+"px"),a.safeApply()}).on("mouseout",function(){v.classed("hidden",!0),z=null,t.tooltipCountry=null})}function i(){var a=$("#typeahead");c.getItems().then(function(b){function c(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}var e=(_.forEach(b,function(b){a.append($("<option>",b))}),{});$.fn.select2.amd.require(["select2/compat/matcher"],function(b){E=a.select2({dropdownParent:$(".header-controls"),dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a,b){if(a.loading)return a.text;var b=e.term||"",d=c(a.text,b);return d},matcher:b(function(a,b){return 0==b.toUpperCase().indexOf(a.toUpperCase())?!0:!1}),language:{searching:function(a){return e=a,"Searchingâ€¦"}},maximumSelectionLength:5})}),a.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&j(a.params.data.id)}),a.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&j(a.params.data.id)}),a.on("change",function(b,c){F=a.val()||[],console.log(F),F.length>0?d.updateQueryParam("countries",a.val().join(",")):d.updateQueryParam("countries",null)});var f=d.getCountriesFromParams(b);$("#typeahead").val(f.length>0?f:null),f.length>0&&(console.log(f),f.forEach(function(a){j(a)}))})}function j(a){var b=_.find(d3.selectAll(".unit").data(),{id:a});b&&C.clicked(b)}function k(){var a=parseInt(this.getAttribute("data-zoom")),b=1;d3.event.preventDefault(),b=C._.zoomBehavior.scale()+1*a,l(b)}function l(a){var b=[C.properties.width/2,C.properties.height/2],c=C._.zoomBehavior.scaleExtent(),d=C._.zoomBehavior.translate(),e=[],f=[],g={x:d[0],y:d[1],k:C._.zoomBehavior.scale()};return a<c[0]||a>c[1]?!1:(e=[(b[0]-g.x)/g.k,(b[1]-g.y)/g.k],g.k=a,f=[e[0]*g.k+g.x,e[1]*g.k+g.y],g.x+=b[0]-f[0],g.y+=b[1]-f[1],C._.zoomBehavior.scale(g.k),B.value(g.k),C._.zoomBehavior.translate([g.x,g.y]),C.zoom(),void 0)}function m(){b(function(){t.tableData={mostFree:[],quartile2:[],quartile3:[],leastFree:[]};var a=d3.selectAll(".unit").data(),b=u-1,c=[],d=null,e=null,f=null,g=null,h=0,i="";b>=0&&(c=t.yearsData[D[b]]),a=a.filter(function(a){return a.data?!0:!1}),a.sort(function(a,b){return a.data.ranking-b.data.ranking});for(var j=0;j<a.length;j++)if(d=a[j].data,f=_.find(c,{iso_code:d.iso_code}),f&&(h=d[C.column()]-f[C.column()],0>h?i="fa-arrow-down":h>0&&(i="fa-arrow-up"),d.arrowClass=i),e=C.colorScale(d[C.column()]),g=_.find(t.colorRange,{color:e}))switch(g.name){case"most-free":t.tableData.mostFree.push(d);break;case"2nd-quart":t.tableData.quartile2.push(d);break;case"3rd-quart":t.tableData.quartile3.push(d);break;case"least-free":t.tableData.leastFree.push(d)}},0)}function n(){x=$(".main-panel").width(),w=$(".main-panel").height(),C.path.projection().translate([x/2,w/2+150]).scale([x/5]).precision(.1),C.svg.attr("width",x).attr("height",w),C.svg.select("rect").attr("width",x).attr("height",w),C.svg.selectAll("path").attr("d",C.path),C.width(x),C.height(w)}function o(){b(function(){n()},100)}function p(a){$("#typeahead").val(_.map(C._.selectedList,function(a){return a.id.toUpperCase()})).trigger("change")}function q(){var b="world";F=[],d3.selectAll(".unit.active").each(function(a){F.push(a)}),t.selectedCountries=_.map(F,function(a){return a.tracker=a.id+"-"+t.currentYear,a}),t.selectedCountries.length>0&&(b="country-info"),$('.nav-pills a[href="#'+b+'"]').tab("show"),a.safeApply()}function r(){d3.select(".legend-panel").selectAll("div").data(_.reverse(t.colorRange)).enter().append("div").classed("legend-color",!0).style("background-color",function(a){return a.color})}function s(){C.data=t.yearsData[t.currentYear]||[],C.update()}var t=this;t.tableData={limit:10,mostFree:[],quartile2:[],quartile3:[],leastFree:[]},t.sidepanels={showRanking:!1,showCountryPanel:!1};var u=null;t.onSliderChange=function(c,e){b(function(){u=c,t.currentYear=e,s(),q(),d.updateQueryParam("year",e),a.safeApply()},50)},t.slider={value:0,step:1,dataValues:[]};var v=null,w=$(".main-panel").height(),x=$(".main-panel").width(),y=($("#typeahead"),[],null),z=null,A=[{color:"#ee3b58",name:"least-free",value:3,text:"Least Free"},{color:"#fcab4a",name:"3rd-quart",value:2,text:"3rd Quartile"},{color:"#b8d051",name:"2nd-quart",value:1,text:"2nd Quartile"},{color:"#00bbbc",name:"most-free",value:0,text:"Most Free"}];t.colorRange=A;var B=d3.slider().min(1).max(10).step(1).orientation("vertical");d3.select("#zoom-slide").call(B),B.on("slide",function(){l(B.value())}),d3.selectAll("i[data-zoom]").on("click",k);var C,D,E,F,G;e(),d3.select(window).on("resize",o),a.safeApply=function(b){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?b&&"function"==typeof b&&b():a.$apply(b)}}function sliderDirectiveLink(a,b,c){function d(){a.min=1,a.max=a.data.length,a.d3Slider=d3.slider().step("undefined"!=typeof a.step?a.step:1).value(a.value).animate(!1).min(a.min).max(a.max).orientation(a.orientation).snap(!1);var b=setInterval(function(){d3.select("."+a.id).selectAll("*").remove(),d3.select("."+a.id).call(a.d3Slider),$("."+a.id+" a.d3-slider-handle").append(l),_.isArray(a.value)?e(a.value):l.html(a.data[a.value-1]),a.safeApply(),window.clearInterval(b),f()},50);a.d3Slider.on("slide",function(){f()}),a.d3Slider.on("slideend",function(){f()})}function e(b){$("#handle-one .popover-single-value").html(a.data[b[0]-1]),$("#handle-two .popover-single-value").html(a.data[b[1]-1]);var c;c=setTimeout(function(){var a=$("#handle-two .popover-single-value").offset().left-$("#handle-one .popover-single-value").offset().left;$(".d3-slider-range").width(a),window.clearTimeout(c)},0)}function f(){var b=a.d3Slider.value();if(_.isArray(b))b[0]===b[1]&&b[0]--,e(b),a.onValueChange({dataValue:[b[0]-1,b[1]-1],value:[a.data[b[0]-1],a.data[b[1]-1]]});else{var c=a.d3Slider.value()-1,d=a.data[c];l.html(d),a.onValueChange({dataValue:c,value:d})}a.safeApply()}function g(){a.pauseState?h():i()}function h(){a.pauseState=!1,k=setInterval(function(){var b=a.d3Slider.value();if(b<a.max){j=!1;var c=b+a.step;a.d3Slider.value(c>a.max?a.max:c),f()}else j?(b=a.min,a.d3Slider.value(a.min)):(j=!0,i()),f(),a.safeApply()},750)}function i(){a.pauseState=!0,window.clearInterval(k),a.safeApply()}a.id="slider-"+(new Date).getTime(),a.pauseState=!0;var j=!0,k=null,l=$('<div class="slider-popover popover-single-value"></div>');a.$watch(function(){return a.data},function(a,b){d()}),a.$watch(function(){return a.value},function(a,b){d()}),a.playPause=g,d(),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},$(window).resize(function(){this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},200)}),$(window).bind("resizeEnd",function(){_.isArray(a.value)&&e(a.value)})}function fraserDataset(a,b,c,d,e,f){function g(){var a=_.find(q.filterList,{id:+c.getQueryParamValue("filter",0)});a||(a=q.filterList[0],c.getQueryParamValue("filter",0)),q.filter.selectedText=a.name,q.filter.selected=a.id}function h(){q.table={orderField:c.getQueryParamValue("sort-field","summary_index"),orderReversed:1==+c.getQueryParamValue("sort-reversed",1)?!0:!1}}function i(){var a,b=_.last(q.dataPoints);if("range"==q.dateType){if(b=[q.dataPoints[0],_.last(q.dataPoints)],a=_.clone(b),a[0]=c.getQueryParamValue("min-year",b[0]),a[1]=c.getQueryParamValue("max-year",b[1]),c.updateQueryParam("year",null),+a[0]>+a[1]){var d=a[0];a[0]=a[1],a[1]=d}return q.dataPoints.indexOf(a[0])<0&&(a[0]=b[0]),q.dataPoints.indexOf(a[1])<0&&(a[1]=b[1]),{years:a,yearIndex:[q.dataPoints.indexOf(a[0])+1,q.dataPoints.indexOf(a[1])+1]}}return a=c.getQueryParamValue("year",b),c.updateQueryParam("min-year",null),c.updateQueryParam("max-year",null),q.dataPoints.indexOf(a)<0&&(a=b),{year:a,yearIndex:q.dataPoints.indexOf(a)+1}}function j(){var a=i();q.currentYear=a.year,q.slider={value:a.yearIndex,step:1,dataValues:q.dataPoints},q.onSliderChange=function(a,d){f(function(){q.currentYear=d,_.isArray(d)?(c.updateQueryParam("min-year",d[0]),c.updateQueryParam("max-year",d[1])):c.updateQueryParam("year",d),l(),b.safeApply()},50)},l()}function k(a){return _.isUndefined(p[a])&&(p[a]=_.map(q.yearsData[a],function(b){var c={};return c.iso_code=b.iso_code,c.country=b.country,c.year=a,c.category=u(b.summary_index),c.summary_index=b.summary_index,c.trStyle={color:t(b.summary_index)},c.sizeOfGoverment=b.Area1.value,c.sizeOfGovermentStyle={color:t(parseFloat(c.sizeOfGoverment))},c.legalSystem=b.Area2.value,c.legalSystemStyle={color:t(parseFloat(c.legalSystem))},c.soundMoney=b.Area3.value,c.soundMoneyStyle={color:t(parseFloat(c.soundMoney))},c.freedomToTrade=b.Area4.value,c.freedomToTradeStyle={color:t(parseFloat(c.freedomToTrade))},c.regulation=b.Area5.value,c.regulationStyle={color:t(parseFloat(c.regulation))},c})),p[a]}function l(){f(function(){if(_.isArray(q.currentYear)){q.tableData=[];for(var a=q.dataPoints.indexOf(q.currentYear[0]),c=q.dataPoints.indexOf(q.currentYear[1]),d=a;c>=d;d++)q.tableData=q.tableData.concat(k(q.dataPoints[d]))}else q.tableData=k(q.currentYear);q.tableData.sort(function(a,b){return b.summary_index-a.summary_index});for(var e=0,f=0,d=0;d<q.tableData.length;d++){var g,h,i,j=+q.tableData[d].summary_index||0;0==d?(q.tableData[d].ranking=1,e=1):d>0&&(g=d-1,h=+q.tableData[g].summary_index||0,h>j?(i=e+1+f,q.tableData[d].ranking=i,e=i,f=0):(q.tableData[d].ranking=e,f++))}q.filterChanged(),b.safeApply()},0)}function m(){q.filter.countries=$(".chosen-select").val()||[],b.safeApply(),c.updateQueryParam("countries",q.filter.countries.length?q.filter.countries.join(","):null)}function n(){var d=$(".chosen-select");d.html(""),e.showLoading=!0,a.getItems().then(function(a){function f(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}var g=(_.forEach(a,function(a){d.append($("<option>",a))}),{});if(s=d.select2({width:"100%",dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a){if(a.loading)return a.text;var b=g.term||"",c=f(a.text,b);return c},maximumSelectionLength:5}),d.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&m()}),d.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&m()}),d.on("change",function(a,b){m()}),q.filter.countries=c.getCountriesFromParams(a),q.filter.countries.length>0){var h=_.find(q.filterList,{id:1});q.filter.selected=h.id,q.filter.selectedText=h.name,$(".chosen-select").val(q.filter.countries).trigger("change"),q.filterChanged()}e.showLoading=!1,b.safeApply()})}function o(){g(),j(),n(),h(),b.safeApply();var a=setTimeout(function(){$(document).ready(function(){$(".dropdown-toggle").dropdown()}),window.clearTimeout(a)},0)}c.clearAreaParams(),c.updateQueryParam("type",null);var p={},q=this,r=d3.keys(q.yearsData);q.dataPoints=r,q.dateType=c.getQueryParamValue("date-type","single"),q.filter={selected:null,limit:0,categories:[{id:1,queryParam:"most-free",name:"MOST FREE",cssClass:"filter-most-free",active:!0,color:"#00bbbc"},{id:2,queryParam:"quartile2",name:"2ND QUARTILE",cssClass:"filter-2nd-quart",active:!0,color:"#b8d051"},{id:3,queryParam:"quartile3",name:"3RD QUARTILE",cssClass:"filter-3rd-quart",active:!0,color:"#fcab4a"},{id:4,queryParam:"least-free",name:"LEAST FREE",cssClass:"filter-least-free",active:!0,color:"#ee3b58"}],countries:[]},q.filter.categories.forEach(function(a){var b=+c.getQueryParamValue(a.queryParam,1);a.active=1==b?!0:!1}),q.tableCountryFilter=function(a,b,c){return 1!=q.filter.selected?a:0==q.filter.countries.length?a:q.filter.countries.indexOf(a.iso_code)>=0?a:void 0},q.filterChanged=function(){if(3==q.filter.selected)q.filter.limit=10,q.filteredTableData=_.clone(q.tableData).splice(0,10),b.safeApply();else if(q.filter.limit=q.tableData.length,0==q.filter.selected||1==q.filter.selected||4==q.filter.selected)q.filteredTableData=q.tableData;else if(2==q.filter.selected){var a,d=_.filter(q.filter.categories,{active:!0});q.filteredTableData=_.filter(q.tableData,function(b){return a=_.find(d,{id:b.category}),a?b:!1})}c.updateQueryParam("filter",q.filter.selected),q.filter.categories.forEach(function(a){c.updateQueryParam(a.queryParam,a.active?1:0)}),b.safeApply()},q.filterList=[{id:0,name:"ALL"},{id:1,name:"INDIVIDUAL COUNTRY"},{id:2,name:"ECONOMIC FREEDOM QUARTILE"},{id:3,name:"TOP 10 COUNTRIES"},{id:4,name:"CUSTOM"}],q.selectFilter=function(a){q.filter.selectedText=a.name,q.filter.selected=a.id,q.filterChanged()},q.setTableOrdering=function(a){c.updateQueryParam("sort-field",a),q.table.orderField==a?q.table.orderReversed=!q.table.orderReversed:(q.table.orderField=a,q.table.orderReversed=!0),c.updateQueryParam("sort-reversed",q.table.orderReversed?1:0)},q.toggleCategory=function(a){a.active=!a.active,q.filterChanged()},q.hideLoading=function(){e.showLoading=!1},q.setDateType=function(a){if(q.dateType=a,c.updateQueryParam("date-type",a),"single"==q.dateType)c.updateQueryParam("max-year",null),c.updateQueryParam("min-year",null),c.updateQueryParam("year",_.last(q.dataPoints)),q.slider.value=q.dataPoints.indexOf(_.last(q.dataPoints));else{var b=_.last(q.dataPoints),d=q.dataPoints[q.dataPoints.length-2];console.log(b,d),c.updateQueryParam("max-year",b),c.updateQueryParam("min-year",d),c.updateQueryParam("year",null),q.slider.value=[q.dataPoints.indexOf(d)+1,q.dataPoints.indexOf(b)+1]}},q.downloadFilteredData=function(){var a=[];if("range"==q.dateType?(a.push("start_year="+c.getQueryParamValue("max-year",_.last(q.dataPoints))),a.push("end_year="+c.getQueryParamValue("min-year",_.first(q.dataPoints)))):(a.push("start_year="+c.getQueryParamValue("year",_.last(q.dataPoints))),a.push("end_year="+c.getQueryParamValue("year",_.last(q.dataPoints)))),1==q.filter.selected&&q.filter.countries.length>0&&q.filter.countries.forEach(function(b){a.push("iso_code[]="+b)}),2==q.filter.selected){var b=_.filter(q.filter.categories,{active:!0});console.log(b),b.forEach(function(b){a.push("category[]="+b.id)})}3==q.filter.selected&&a.push("category[]=top");var e=_.get(Drupal,"settings.fraserApp.appBaseUrl","http://fi.ixm.ca/")+"api/economic-data";a.length>0&&(e+="?"+a.join("&")),console.log(e),d.open(e,"_blank")},q.tableData=[];var s,t=d3.scale.quantize().domain([0,10]).range(_.map(q.filter.categories,"color").reverse()),u=d3.scale.quantize().domain([0,10]).range(_.map(q.filter.categories,"id").reverse());b.safeApply=function(a){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?a&&"function"==typeof a&&a():b.$apply(a)},o()}function fraserGraph(a,b,c,d){function e(){_.forEach(w.yearsData,function(a,b){w.worldData[b]=f(a,b)})}function f(a,b){var c=_.extend(i(),{year:b,country:"World",iso_code:"WOR"}),d="",e=0,f=0;a.forEach(function(a){a.year=b,e=0;for(var f=0;f<w.categories.length;f++)d=w.categories[f].key,e=+_.get(c,d,0)+ +_.get(a,d,0),_.set(c,d,e)}),e=0;for(var g=0;g<w.categories.length;g++)d=w.categories[g].key,e=_.get(c,d,0)/a.length,_.set(c,d,e),f+=e;return c.summary_index=f/w.categories.length,c}function g(){$("#charts").html(""),y=$("#charts").width();var a={top:20,right:20,bottom:30,left:20};y=y-a.left-a.right,z=400-a.top-a.bottom,G=d3.scale.ordinal().rangeRoundBands([0,y],.1),F=d3.scale.ordinal().rangeRoundBands([0,y],.1),H=d3.scale.ordinal(),I=d3.scale.linear().range([z,0]).domain([0,10]),A=d3.svg.axis().scale(F).orient("bottom"),B=d3.svg.axis().scale(G).orient("bottom"),C=d3.svg.axis().innerTickSize(-y).outerTickSize(0).scale(I).orient("left"),D=d3.select("#charts").append("svg").attr("width",y+a.left+a.right).attr("height",z+a.top+a.bottom).attr("align","center").append("g").attr("transform","translate("+a.left+","+a.top+")"),D.append("g").attr("class","y axis").call(C).append("text").attr("transform","rotate(-90)").attr("y",5).attr("dy","1em").style("text-anchor","end");var b=d3.select(D.selectAll(".y.axis .tick")[0][0]);b.select("text").attr("visibility","hidden"),b.select("line").attr("class","first-y-axis"),E=D.append("g").attr("class","tooltip-chart").style("display","none"),E.append("rect").attr("width",40).attr("height",20).attr("fill","white").style("opacity",1),E.append("text").attr("x",15).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold")}function h(){var a=w.yearsData[w.currentYear];if(w.filter.countries.length>0){var c=_.filter(w.countriesList,function(a){return w.filter.countries.indexOf(a.value)>=0}),d={};w.graphData=_.map(c,function(b){return d=_.find(a,{iso_code:b.value}),b.country=b.text,b.summary_index=0,d&&(b.Area1=d.Area1,b.Area2=d.Area2,b.Area3=d.Area3,b.Area4=d.Area4,b.Area5=d.Area5,b.summary_index=d.summary_index),b})}else{var d=w.worldData[w.currentYear];w.graphData=d?[d]:[]}b.safeApply(),q()}function i(){return{Area1:{value:0},Area2:{value:0},Area3:{value:0},Area4:{value:0},Area5:{value:0},summary_index:0}}function j(a){var b=_.filter(w.categories,{active:!0});return b.length!==w.categories.length&&b.length>0&&(a.calculated_index=0,_.forEach(b,function(c){var d=(+_.get(a,c.key,0)).toFixed(2)/b.length;a.calculated_index+=d})),a}function k(){w.lineGraphData=[];var a,b,c,d=w.dateRange,e=[];if(w.filter.countries.length>0){var f=_.filter(w.countriesList,function(a){return w.filter.countries.indexOf(a.value)>=0});w.lineGraphData=f.map(function(f,g){a={iso_code:f.value,country:f.text,color:w.categories[g].color,values:[]};for(var h=d[0];h<=d[1];h++)c=w.dataPoints[h],e=w.yearsData[c],b=_.find(e,{iso_code:f.value}),b=b?b:i(),b.year=c,b.calculated_index=b.summary_index,b=j(b),b.calculated_index>0&&a.values.push(b);return a})}else{for(var g=[],h=d[0];h<=d[1];h++)c=w.dataPoints[h],b=w.worldData[c],b.calculated_index=b.summary_index,g.push(j(b));w.lineGraphData=[{iso_code:"WOR",country:"WORLD",color:w.categories[0].color,values:g}]}w.lineGraphData=_.map(w.lineGraphData,function(a){return a}),p()}function l(){D.select(".x.axis").remove(),D.selectAll(".country").remove(),D.selectAll(".line-graph").remove()}function m(){w.categories.forEach(function(a){c.updateQueryParam(a.queryParam,a.active?1:0)}),w.filter.countries.length>0&&c.updateQueryParam("countries",w.filter.countries.join(",")),"bar"===w.graphSelector?h():k(),b.safeApply()}function n(a,b){return G(a)+G.rangeBand()/2-b}function o(a,c,d,e){E=d3.select(".tooltip-graph"),E.classed("hidden",!1),E.attr("style","left:"+d+"px;top:"+e+"px"),w.tooltipValue=a,b.$apply()}function p(){l(),G.domain(_.filter(w.dataPoints,function(a,b){return b>=w.dateRange[0]&&b<=w.dateRange[1]?a:void 0})),D.append("g").attr("class","x axis line-x-axis").attr("transform","translate(0,"+z+")").call(B);var a=d3.svg.line().x(function(a){return n(a.year,20)}).y(function(a){return I(a.calculated_index)}).defined(function(a){return a.calculated_index>0}),b=D.append("g").attr("transform","translate(20,20)").attr("class","line-graph"),c=b.selectAll(".country").data(w.lineGraphData).enter().append("g").attr("class","country");c.append("path").attr("class","line").attr("style",function(a,b){return"stroke : "+a.color+";"}).attr("d",function(b){return a(b.values)});var d;w.lineGraphData.forEach(function(a){d=b.selectAll(".circle-"+a.iso_code).data(a.values).enter(),d.append("circle").attr("class",function(b){return"circle-"+a.iso_code+"-"+b.year}).attr("style",function(b,c){return"stroke : "+a.color+";"}).attr("r",4).attr("cx",function(a){return n(a.year,20)}).attr("cy",function(a){return I(a.calculated_index)}).on("mouseover",function(a){var b=$(this).position();b.left-=20,b.top-=40,o(a.calculated_index,this,b.left,b.top)}).on("mouseout",function(){E.classed("hidden",!0),w.tooltipValue=null})})}function q(){l();var a=_.filter(w.categories,{active:!0});w.graphData.forEach(function(b){b.categories=_.map(a,function(a){var c=(+_.get(b,a.key,0)).toFixed(2);return{name:a.name,value:c,label:c>.5?c:"N/A",color:a.color}})}),F.domain(w.graphData.map(function(a){return a.country}));var c=d3.min([(y-100)/5,150]);H.domain(w.categories.filter(function(a){return a.active}).map(function(a){return a.name})).rangeRoundBands([0,c]),D.append("g").attr("class","x axis").attr("transform","translate(0,"+z+")").call(A);var d=D.selectAll(".country").data(w.graphData),e=d.enter().append("g").attr("class","country").style("fill","blue").attr("transform",function(a){return"translate("+F(a.country)+",0)"}),f=e.selectAll("rect").data(function(a){return a.categories});f.exit().remove(),f.enter().append("rect").attr("width",function(){return H.rangeBand()-2}).attr("x",function(a){return H(a.name)+1+F.rangeBand()/2-c/2}).attr("y",function(a){return I(a.value)}).attr("height",function(a){return z-I(a.value)}).style("fill",function(a){return a.color}).on("mouseover",function(a){var b=(H.rangeBand()-2)/2,c=$(this).position();c.left=c.left-25+b,c.top-=40,o(a.value,this,c.left,c.top)}).on("mouseout",function(){E.classed("hidden",!0),w.tooltipValue=null}),b.safeApply()}function r(a){w.slider={value:a,step:1,dataValues:x},w.dateRange=[w.slider.value[0]-1,w.dataPoints.length-1],w.onSliderChange=function(a,b){d(function(){_.isArray(a)?(w.dateRange=a,c.updateQueryParam("min-year",b[0]),c.updateQueryParam("max-year",b[1]),c.updateQueryParam("year",null)):(w.currentYear=b,c.updateQueryParam("min-year",null),c.updateQueryParam("max-year",null),c.updateQueryParam("year",b)),m()},0)}}function s(){var b=$("#typeahead");a.getItems().then(function(a){function c(a,b){var c=a.toUpperCase().indexOf(b.toUpperCase()),d=$("<span></span>");if(0>c)return d.text(a);d.text(a.substring(0,c));var e=$('<span class="select2-rendered__match"></span>');return e.text(a.substring(c,c+b.length)),d.append(e),d.append(a.substring(c+b.length)),d}g(),w.countriesList=a;var d=(_.forEach(a,function(a){b.append($("<option>",a))}),{});J=b.select2({dropdownCssClass:"map-typeahed--dropdown",templateResult:function(a){if(a.loading)return a.text;var b=d.term||"",e=c(a.text,b);return e},maximumSelectionLength:5}),b.on("select2:unselect",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(w.filter.countries=b.val()||[],m())}),b.on("select2:select",function(a){a&&a.params&&a.params.data&&a.params.data.id&&(w.filter.countries=b.val()||[],m())}),b.on("change",function(a,c){w.filter.countries=b.val()||[],m()}),v()})}function t(){var a,b=_.last(w.dataPoints);if("line"==w.graphSelector){if(b=[w.dataPoints[0],_.last(w.dataPoints)],a=_.clone(b),a[0]=c.getQueryParamValue("min-year",b[0]),a[1]=c.getQueryParamValue("max-year",b[1]),+a[0]>+a[1]){var d=a[0];a[0]=a[1],a[1]=d}return w.dataPoints.indexOf(a[0])<0&&(a[0]=b[0]),w.dataPoints.indexOf(a[1])<0&&(a[1]=b[1]),{years:a,yearIndex:[w.dataPoints.indexOf(a[0])+1,w.dataPoints.indexOf(a[1])+1]}}return a=c.getQueryParamValue("year",b),w.dataPoints.indexOf(a)<0&&(a=b),{year:a,yearIndex:w.dataPoints.indexOf(a)+1}}function u(){w.categories.forEach(function(a){a.active=+c.getQueryParamValue(a.queryParam,1)>0?!0:!1,c.updateQueryParam(a.queryParam,a.active?1:0)})}function v(){var a=c.getQueryParamValue("type","line");"line"!=a&&"bar"!=a&&(a="line");var b=t();r(b.yearIndex),_.isArray(b.year)?(c.updateQueryParam("min-year",b.year[0]),c.updateQueryParam("max-year",b.year[1])):c.updateQueryParam("year",b.year),w.filter.countries=c.getCountriesFromParams(w.countriesList),$("#typeahead").val(w.filter.countries).trigger("change"),u(),w.changeGraph(a)}c.updateQueryParam("sort-field",null),c.updateQueryParam("sort-reversed",null),c.updateQueryParam("date-type",null),c.updateQueryParam("filter",null),c.updateQueryParam("most-free",null),c.updateQueryParam("least-free",null),c.updateQueryParam("quartile3",null),c.updateQueryParam("quartile2",null);var w=this,x=d3.keys(w.yearsData);w.dataPoints=x,w.worldData={},b.safeApply=function(a){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?a&&"function"==typeof a&&a():b.$apply(a)},w.selectAllCategories=!0,w.toggleCategory=function(a){a.active=!a.active,m()},w.toggleAllCategories=function(a){a||(w.selectAllCategories=!w.selectAllCategories),w.categories.forEach(function(a){a.active=w.selectAllCategories}),m()},w.changeGraph=function(a){w.graphSelector=a,c.updateQueryParam("type",a),w.slider.value=t().yearIndex,m()},w.filter={countries:[]},w.categories=[{name:"Size of Government",active:!0,color:"#ce0932",key:"Area1.value",queryParam:"area1"},{name:"Legal System and Property Rights",active:!0,color:"#dd8c2c",key:"Area2.value",queryParam:"area2"},{name:"Sound Money",active:!0,color:"#74862c",key:"Area3.value",queryParam:"area3"},{name:"Freedom to Trade Internationally",active:!0,color:"#00a3a4",key:"Area4.value",queryParam:"area4"},{name:"Regulation",active:!0,color:"#90a738",key:"Area5.value",queryParam:"area5"}],w.buildGraphData=m;var y,z,A,B,C,D,E,F,G,H,I,J;e(),s(),$(window).resize(function(){this.resizeTO&&clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},200)}),$(window).bind("resizeEnd",function(){g(),m();var a=t();r(a.yearIndex)})}function dataService(a,b){var c=36e5;return"localStorage"in window||(window.localStorage={_data:{},setItem:function(a,b){return this._data[a]=String(b)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:void 0},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}}),{getData:function(){var d=b.defer(),e=window.localStorage.getItem("fraser.data"),f=window.localStorage.getItem("fraser.data.time");f=f?+f:0;var g=(new Date).getTime()-f>c;return e&&!g?d.resolve(JSON.parse(e)):a.get("/fraser.json",{cache:!0}).then(function(a){200==a.status&&200==a.data.code&&a.data.data&&(window.localStorage.setItem("fraser.data",JSON.stringify(a.data.data)),window.localStorage.setItem("fraser.data.time",(new Date).getTime()),d.resolve(a.data.data))},function(a){d.reject(a)}),d.promise}}}function typeAheadService(a,b){var c=[],e=[];return{setItems:function(a){c=a},getItems:function(){var e=b.defer();return c.length>0?d.resolve(c):a.get("vendors/d3-geomap/topojson/world/countries.json").then(function(a){200==a.status?(c=_.map(_.get(a,"data.objects.units.geometries"),function(a){return{value:a.id,text:a.properties.name}}),e.resolve(c)):e.reject("data not found")},function(){e.reject("data not found")}),e.promise},setSelected:function(a){e=a},getSelecetd:function(){return e}}}function paramsService(a){function b(){for(var a=1;5>=a;a++)d("area"+a,null)}function c(b,c){return _.get(a.search(),b,c)}function d(b,c){a.search(b,c),g()}function e(a){var b=c("countries","");b=b.toUpperCase();var e=[],f=b.split(",");return f.length>0&&f.forEach(function(b){_.find(a,{value:b})&&e.push(b)}),e=e.splice(0,5),d("countries",e.length>0?e.join(","):null),g(),e}function f(){var b=a.search().page,c=localStorage.getItem("fraser.querystring");if(c){var d=JSON.parse(c);if(b!=d.page){delete d.page;var e=_.keys(d);console.log(e),e.forEach(function(b){a.search(b,d[b])})}}}function g(){var b=a.search();return localStorage.setItem("fraser.querystring",JSON.stringify(b))}return{getQueryParamValue:c,updateQueryParam:d,getCountriesFromParams:e,clearAreaParams:b,restoreQueryStrings:f}}angular.module("fraserMapApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(appConfig).run(appRun),appConfig.$inject=["$routeProvider","$locationProvider"],appRun.$inject=["$rootScope"],angular.module("fraserMapApp").controller("MainCtrl",mainController),mainController.$inject=["yearsData","$location","fraserParams","$rootScope"],angular.module("fraserMapApp").directive("fraserMap",function(){return{templateUrl:"views/map-page.html",restrict:"E",controller:mapDirectiveController,controllerAs:"vm",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),mapDirectiveController.$inject=["$scope","$timeout","typeaheadService","fraserParams"],angular.module("fraserMapApp").directive("fraserSlider",function(){return{templateUrl:"views/partials/slider.html",restrict:"E",scope:{orientation:"=",step:"=",value:"=",data:"=",showPlay:"=",onValueChange:"&"},link:sliderDirectiveLink}}),angular.module("fraserMapApp").directive("mapCountryPanel",function(){return{templateUrl:"views/partials/map-country-panel.html",restrict:"E",scope:{country:"=",colorRange:"="},link:function(a,b,c){function d(){a.data={},a.data.summary_index=a.country.data?a.country.data.summary_index+" / 10":"N/A",a.data.name=a.country.properties.name,a.data.flagIcon="flag-"+a.country.id.toLowerCase(),a.data.color=_.get(a.country,"data.color",null);var b=_.find(a.colorRange,{color:a.data.color});a.data.labelClass="label label-nodata",a.data.labelText="no data",b&&(a.data.labelClass="label label-"+b.name,a.data.labelText=b.text),a.articles=[{head:"Size of Government",icon:"fa-area-chart",key:"data.Area1.value",value:null},{head:"Legal System and Property Rights",icon:"fa-first-order",key:"data.Area2.value",value:null},{head:"Sound Money",icon:"fa-archive",key:"data.Area3.value",value:null},{head:"Freedom to Trade Internationally",icon:"fa-building",key:"data.Area4.value",value:null},{head:"Regulation",icon:"fa-beer",key:"data.Area5.value",value:null}];var c;console.log(a.country),a.articles.forEach(function(b){c=_.get(a.country,b.key,null),b.value=c?parseFloat(c).toFixed(2):"N/A"})}a.$watch(function(){return a.country.tracker;
},function(a,b){a!=b&&d()}),d()}}}),angular.module("fraserMapApp").directive("fraserDataset",function(){return{templateUrl:"views/dataset-page.html",controllerAs:"vm",controller:fraserDataset,restrict:"E",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),fraserDataset.$inject=["typeaheadService","$scope","fraserParams","$window","$rootScope","$timeout"],angular.module("fraserMapApp").directive("fraserGraph",function(){return{templateUrl:"views/graph-page.html",controllerAs:"vm",controller:fraserGraph,restrict:"E",bindToController:!0,scope:{yearsData:"="},link:function(){}}}),fraserGraph.$inject=["typeaheadService","$scope","fraserParams","$timeout"],angular.module("fraserMapApp").service("fraserData",dataService),dataService.$inject=["$http","$q"],angular.module("fraserMapApp").service("typeaheadService",typeAheadService),typeAheadService.$inject=["$http","$q"],angular.module("fraserMapApp").service("fraserParams",paramsService),paramsService.$inject=["$location"],angular.module("fraserMapApp").directive("offcanvasSidebar",function(){return{restrict:"E",templateUrl:"views/partials/offcanvas-sidepanel.html",transclude:!0,scope:{visible:"=",alignment:"@"},link:function(a,b){console.log("sidepanel scope ",a),a.closeSidePanel=function(){a.visible=!1}}}}),angular.module("fraserMapApp").run(["$templateCache",function(a){a.put("views/dataset-page.html",'<div class="container-fluid dataset-header"> <div class="col-sm-offset-1 col-md-10 dataset-header-container"> <div class="col-md-9 dataset-header-wrapper"> <div class="dataset-title">Download Dataset</div> <div class="dataset-subtitle">Economic Freedom Rankings</div> <div class="dropdown dataset-datarange-selector"> <span class="dropdown-toggle" type="button" data-toggle="dropdown"> {{vm.dateType == "single" ? "Select Specific Date" : "Select Date Range"}} <span class="caret"></span> </span> <ul class="dropdown-menu"> <li><a ng-click="vm.setDateType(\'range\')">Date Range</a></li> <li><a ng-click="vm.setDateType(\'single\')">Specific Dates</a></li> </ul> </div> </div> <div class="col-md-3 fraser-download-container"> <div class="fraser-download-container--cell"> <div class="fraser-download-container--wrapper"> <a href="/api/economic-data" target="_blank" class="btn btn-primary fraser-download-button"> Download Entire Dataset <i class="fa fa-download fraser-download-button--icon" aria-hidden="true"></i> </a> </div> </div> </div> </div> <div class="col-sm-offset-1 col-md-10 dataset-slider-container"> <fraser-slider show-play="false" step="1" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"> </fraser-slider> </div> </div> <div class="container-fluid filters"> <div class="col-sm-offset-1 col-md-10 filters-wrapper"> <i class="fa fa-filter filter-icon" aria-hidden="true"></i> <span>Filter By : </span> <span class="dropdown dataset-filter-selector"> <span class="dropdown-toggle dataset-filter-button" type="button" data-toggle="dropdown"> {{vm.filter.selectedText}} <span class="caret"></span> </span> <ul class="dropdown-menu"> <li ng-repeat="filter in vm.filterList" ng-click="vm.selectFilter(filter)"> <a ng-bind="filter.name"></a> </li> </ul> </span> <span class="dataset-filter-container"> <div class="quartile-filters" ng-show="vm.filter.selected == 2"> <span ng-repeat="category in vm.filter.categories" ng-click="vm.toggleCategory(category)" class="{{category.cssClass}}" ng-class="{\'inactive\': !category.active}" ng-bind="category.name"></span> </div> <div class="typeahead-filters" ng-show="vm.filter.selected == 1"> <select data-placeholder="Find a country" multiple class="chosen-select"> <option></option> </select> </div> </span> <span class="dataset-filter-download-wrapper"> <i class="fa fa-download fraser-download-button--icon pull-right" aria-hidden="true"></i> <button ng-click="vm.downloadFilteredData()" id="dataTypeSelector" class="fraser-download-filtered-button pull-right"> Download Filtered Dataset </button> </span> </div> </div> <div class="dataset-panel container-fluid"> <div class="col-sm-offset-1 col-md-10 dataset-table-panel"> <table class="table dataset-table"> <thead> <tr> <th ng-click="vm.setTableOrdering(\'ranking\')" class="text-center" width="20"> OVERALL RANK <span ng-show="vm.table.orderField == \'ranking\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'ranking\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'country\')" class="text-center"> COUNTRY NAME <span ng-show="vm.table.orderField == \'country\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'country\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'year\')" class="text-center" width="60"> YEAR <span ng-show="vm.table.orderField == \'year\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'year\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'summary_index\')" class="text-center" width="40"> OVERALL SCORE <span ng-show="vm.table.orderField == \'summary_index\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'summary_index\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'sizeOfGoverment\')" class="text-center" width="13%"> SIZE OF GOVERMENT <span ng-show="vm.table.orderField == \'sizeOfGoverment\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'sizeOfGoverment\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'legalSystem\')" class="text-center" width="13%"> Legal System and Property Rights <span ng-show="vm.table.orderField == \'legalSystem\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'legalSystem\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'soundMoney\')" class="text-center" width="13%"> SOUND MONEY <span ng-show="vm.table.orderField == \'soundMoney\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'soundMoney\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'freedomToTrade\')" class="text-center" width="13%"> Freedom to Trade Internationally <span ng-show="vm.table.orderField == \'freedomToTrade\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'freedomToTrade\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> <th ng-click="vm.setTableOrdering(\'regulation\')" class="text-center" width="13%"> REGAULATION <span ng-show="vm.table.orderField == \'regulation\' && !vm.table.orderReversed" class="fa fa-caret-down"></span> <span ng-show="vm.table.orderField == \'regulation\' && vm.table.orderReversed" class="fa fa-caret-up"></span> </th> </tr> </thead> <tbody> <tr ng-if="filteredData.length == 0"> <td colspan="9">No data to display</td> </tr> <tr ng-if="filteredData.length > 0" ng-repeat="entry in vm.filteredTableData  \n          | filter : vm.tableCountryFilter\n          | orderBy : vm.table.orderField : vm.table.orderReversed\n          | limitTo : vm.filter.limit \n          as filteredData\n          track by $index "> <td class="text-center" ng-bind="entry.ranking" ng-style="entry.trStyle"></td> <td class="text-center" ng-bind="entry.country"></td> <td class="text-center" ng-bind="entry.year" width="60"></td> <td class="text-center" ng-bind="entry.summary_index | number: 2" ng-style="entry.trStyle"></td> <td class="text-center" ng-bind="entry.sizeOfGoverment | number: 2" ng-style="entry.sizeOfGovermentStyle"></td> <td class="text-center" ng-bind="entry.legalSystem | number: 2" ng-style="entry.legalSystemStyle"></td> <td class="text-center" ng-bind="entry.soundMoney | number: 2" ng-style="entry.soundMoneyStyle"></td> <td class="text-center" ng-bind="entry.freedomToTrade | number: 2" ng-style="entry.freedomToTradeStyle"></td> <td class="text-center" ng-bind="entry.regulation | number: 2" ng-style="entry.regulationStyle"></td> </tr> </tbody> </table> </div> </div>'),a.put("views/graph-page.html",'<div class="container-fluid charts-topbar"> <div class="col-sm-offset-2 col-md-10"> <select data-placeholder="Find a country" id="typeahead" multiple class="chosen-select"> <option></option> </select> </div> </div> <div class="charts-container container-fluid"> <div class="col-md-2 charts-selection-panel"> <div class="charts-selector"> <div class="charts-selector-text">GRAPH</div> <div ng-class="{\'active\' : vm.graphSelector == \'line\'}" ng-click="vm.changeGraph(\'line\');" class="charts-selector-buttom"> <i class="fa fa-line-chart" aria-hidden="true"></i> </div> <div ng-class="{\'active\' : vm.graphSelector == \'bar\'}" ng-click="vm.changeGraph(\'bar\')" class="charts-selector-buttom"> <i class="fa fa-bar-chart" aria-hidden="true"></i> </div> </div> </div> <div class="col-md-8"> <div id="charts"></div> <fraser-slider ng-if="vm.slider.value" class="charts-timebar" show-play="false" step="1" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"> </fraser-slider> </div> <div class="col-md-2"> <div class="legend" ng-if="vm.graphSelector == \'bar\'"> <div ng-repeat="category in vm.categories" class="pointer legend-row" ng-click="vm.toggleCategory(category)"> <span> <i class="fa fa-circle" aria-hidden="true" ng-style="{\n              color: category.active ? category.color : \'gray\'\n            }"> </i> </span> <span ng-bind="category.name" class="category-text"></span> </div> <div class="pointer" ng-click="vm.toggleAllCategories()"> <span ng-bind="vm.selectAllCategories ? \'Deselect All\' : \'Select All\'" class="category-text"></span> </div> </div> <div class="legend" ng-if="vm.graphSelector == \'line\'"> <div ng-repeat="country in vm.lineGraphData" class="legend-row"> <span> <i class="fa fa-circle" aria-hidden="true" ng-style="{\n              color: country.color\n            }"> </i> </span> <span ng-bind="country.country" class="category-text"></span> </div> <div class="graph-category-filter"> <div class="graph-category-filter--title">Filter By Category : </div> <div> <ul class="line-graph-filter-list"> <li class="line-graph-filter-list--item"> <input ng-click="vm.toggleAllCategories(true)" type="checkbox" ng-model="vm.selectAllCategories" ng-attr-id="{{\'category-check-\' + $index}}"> <label for="{{\'category-check-\' + $index}}"> All </label> </li> <li class="line-graph-filter-list--item" ng-repeat="category in vm.categories track by $index"> <input ng-change="vm.buildGraphData()" type="checkbox" ng-model="category.active" ng-attr-id="{{\'category-check-\' + $index}}"> <label for="{{\'category-check-\' + $index}}" ng-bind="category.name"></label> </li> </ul> </div> </div> </div> </div> </div> <ng-include src="\'views/partials/graph-tooltip.html\'"></ng-include>'),a.put("views/main.html",'<fraser-map ng-if="main.page == \'map\'" years-data="main.yearsData"> </fraser-map> <fraser-graph ng-if="main.page == \'graph\'" years-data="main.yearsData"> </fraser-graph> <fraser-dataset class="dataset-page" ng-if="main.page == \'dataset\'" years-data="main.yearsData"> </fraser-dataset> <div ng-show="showLoading" class="ajax-overlay"> <div class="ajax-overlay--center"> <div class="sk-circle"> <div class="sk-circle1 sk-child"></div> <div class="sk-circle2 sk-child"></div> <div class="sk-circle3 sk-child"></div> <div class="sk-circle4 sk-child"></div> <div class="sk-circle5 sk-child"></div> <div class="sk-circle6 sk-child"></div> <div class="sk-circle7 sk-child"></div> <div class="sk-circle8 sk-child"></div> <div class="sk-circle9 sk-child"></div> <div class="sk-circle10 sk-child"></div> <div class="sk-circle11 sk-child"></div> <div class="sk-circle12 sk-child"></div> </div> </div> </div>'),a.put("views/map-page.html",'<div class="container-map"> <div class="side-panel hidden-sm hidden-xs"> <ul class="nav nav-pills nav-justified"> <li class="map-tab active"><a data-toggle="tab" href="#world">WORLD RANKINGS</a></li> <li ng-class="{\'disabled\' : vm.selectedCountries.length == 0}" class="country-info--tab"><a data-toggle="tab" href="#country-info">COUNTRY INFO</a></li> </ul> <div class="tab-content"> <!-- WORLD TAB --> <div id="world" class="tab-pane fade in active" ng-include="\'views/partials/map-sidepanel-world-tab.html\'"> </div> <!-- END OF WORLD TAB --> <!-- COUNTRY INFO TAB --> <div id="country-info" class="tab-pane fade"> <div class="selected-countries"> <map-country-panel ng-repeat="country in vm.selectedCountries track by country.tracker" color-range="vm.colorRange" country="country"></map-country-panel> </div> </div> <!-- END OF COUNTRY INFO TAB offcanvas--> </div> </div> <offcanvas-sidebar visible alignment="right"> <div class="side-panel offcanvas"> <div class="tab-pane fade in active" ng-include="\'views/partials/map-sidepanel-world-tab.html\'"> </div> </div> </offcanvas-sidebar> <div class="main-panel" ng-class="{\'offcanvas-right\' : vm.sidepanels.showRanking, \'offcanvas-left\' : vm.sidepanels.showCountryPanel }"> <div class="hidden-md hidden-lg hidden-xlg"> <span class="fraser-map-mobile-buttom" ng-click="vm.sidepanels.showRanking = !vm.sidepanels.showRanking;"> Ranking </span> <span class="fraser-map-mobile-buttom" ng-click="vm.sidepanels.showCountryPanel = !vm.sidepanels.showCountryPanel;"> ({{vm.selectedCountries.length > 0 ? vm.selectedCountries.length : \'All\'}}) Countries </span> </div> <div id="graph"> <div class="header-controls"> <select data-placeholder="Find a country" id="typeahead" multiple class="chosen-select"> <option></option> </select> </div> <div class="legend-panel"></div> </div> <div class="zoom-buttons"> <i class="fa fa-plus-square pointer" aria-hidden="true" id="zoom_in" data-zoom="+1"></i> <div id="zoom-slide"></div> <i class="fa fa-minus-square pointer" aria-hidden="true" id="zoom_out" data-zoom="-1"></i> </div> <fraser-slider show-play="true" class="footer-controls" step="vm.slider.step" value="vm.slider.value" data="vm.slider.dataValues" orientation="\'horizontal\'" on-value-change="vm.onSliderChange(dataValue, value)"> </fraser-slider> </div> <offcanvas-sidebar visible alignment="left"> <div class="selected-countries side-panel offcanvas"> <map-country-panel ng-repeat="country in vm.selectedCountries track by country.tracker" color-range="vm.colorRange" country="country"></map-country-panel> </div> </offcanvas-sidebar> </div> <ng-include src="\'views/partials/map-tooltip.html\'"></ng-include> '),a.put("views/partials/graph-tooltip.html",'<div class="hidden tooltip-graph"> <div class="text-center value" ng-bind="vm.tooltipValue | number : 2"> </div> </div>'),a.put("views/partials/map-country-panel.html",'<div class="country-info--item"> <div class="text-center"> <div> <span class="country-flag flag flag-3x" ng-class="data.flagIcon"></span> </div> <h2 class="country-name" ng-bind="data.name"></h2> <h5 class="ranking"> <span class="value" ng-bind="data.summary_index"></span> </h5> <span class="label" ng-class="data.labelClass" ng-bind="data.labelText"></span> <ul class="row"> <li ng-class="{\'no-border\' : $last}" ng-repeat="article in articles track by $index"> <span><i class="article-icon fa" ng-class="article.icon" aria-hidden="true"></i></span> <span class="article-value" ng-bind="article.value"></span> <span class="article-title" ng-bind="article.head"></span> </li> </ul> </div> </div>'),a.put("views/partials/map-sidepanel-world-tab.html",'<div class="world-tab-header"> <div class="text-center world-tab-title"> Economic Freedom <br> Ranking <span class="freedom-ranking-year" ng-bind="vm.currentYear"></span> </div> <div class="share-block"> <div class="pull-left text">Share : </div> <div class="pull-right social-icons"> <i class="fa fa-envelope pointer mail" aria-hidden="true"></i> <i class="fa fa-facebook-official pointer facebook" aria-hidden="true"></i> <i class="fa fa-twitter-square pointer twitter" aria-hidden="true"></i> </div> <div class="clearfix"></div> </div> </div> <div class="country-list-wrapper"> <table class="table country-list"> <thead> <tr> <th>#</th> <th>Country</th> <th>Score</th> </tr> </thead> <tbody> <tr class="most-free-tr" ng-if="vm.tableData.mostFree.length > 0"> <th class="first-free-th" colspan="3"> <span class="label label-most-free">Most Free</span> </th> </tr> <tr ng-if="vm.tableData.mostFree.length > 0" ng-repeat="country in vm.tableData.mostFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="second-free-tr" ng-if="vm.tableData.quartile2.length > 0"> <th class="second-free-th" colspan="3"> <span class="label label-2nd-quart">2nd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile2.length > 0" ng-repeat="country in vm.tableData.quartile2 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="third-free-tr" ng-if="vm.tableData.quartile3.length > 0"> <th class="third-free-th" colspan="3"> <span class="label label-3rd-quart">3rd Quartile</span> </th> </tr> <tr ng-if="vm.tableData.quartile3.length > 0" ng-repeat="country in vm.tableData.quartile3 track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"></tr> <tr class="least-free-tr" ng-if="vm.tableData.leastFree.length > 0"> <th class="least-free-th" colspan="3"> <span class="label label-least-free">Least Free</span> </th> </tr> <tr ng-if="vm.tableData.leastFree.length > 0" ng-repeat="country in vm.tableData.leastFree track by country.iso_code" ng-include="\'views/partials/map-table-row.html\'"> </tr> <tr class="end-tr"> </tr> </tbody> </table> </div>'),a.put("views/partials/map-table-row.html",'<td ng-bind="country.ranking" style="color: {{country.color}}"> </td> <td class="td-country" ng-bind="country.country"> </td> <td class="td-index" style="color: {{country.color}}" width="60"> <span ng-bind="country.summary_index | number : 2"></span> <i class="ranking-difference-indicator fa" ng-class="country.arrowClass" aria-hidden="true"></i> </td>'),a.put("views/partials/map-tooltip.html",'<div class="hidden tooltip-map"> <div class=""> <span class="tooltip--country-flag flag flag-2x" ng-class="vm.tooltipCountry.flagClass"></span> <span class="country-title" ng-bind="vm.tooltipCountry.name"></span> </div> <div class="country-rank" ng-style="{color: vm.tooltipCountry.color}"> <div class="rank"> <div ng-bind="vm.tooltipCountry.rank"> </div> <div class="rank-title"> RANK</div> </div> <div class="overall"> <div ng-bind="vm.tooltipCountry.score"></div> <div class="score-title">SCORE</div> </div> <div class="clear-both"></div> </div> </div>'),a.put("views/partials/offcanvas-sidepanel.html",'<div class="offcanvas-sidevar--wrapper"> <div class="offcanvas-sidebar" ng-class="{show: visible, left: alignment == \'left\', right: alignment == \'right\'}" ng-transclude> </div> <div class="offcanvas-sidebar-underlay" ng-class="{show: visible, left: alignment == \'left\', right: alignment == \'right\'}"> <div class="offcanvas-sidebar-underlay--buttom" ng-click="closeSidePanel()"> <i class="offcanvas-sidebar-underlay--buttom-icon fa fa-times" aria-hidden="true"></i> </div> </div> </div>'),a.put("views/partials/slider.html",'<div class="fraser-slider" ng-class="{\'no-play\' : !showPlay}"> <span ng-if="showPlay"> <span class="timeline-buttom play pointer" ng-click="playPause()"> <i class="fa" ng-class="{\'fa-play\': pauseState, \'fa-pause\': !pauseState}" aria-hidden="true"></i> </span> <span class="timeline-text" ng-bind="pauseState?\'play\':\'pause\';"> </span> </span> <span class="timeline-value min" ng-bind="data[min-1]"></span> <span class="{{id}}"></span> <span class="timeline-value max" ng-bind="data[max-1]"></span> </div>')}]);